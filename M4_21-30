<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Catcher - Vocabulary Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap');
        
        body {
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
            background: #f0f9ff;
            touch-action: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, #87ceeb 0%, #e0f2fe 100%);
            overflow: hidden;
        }

        .game-object {
            position: absolute;
            user-select: none;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .letter {
            width: 45px;
            height: 45px;
            background: white;
            border: 3px solid #3b82f6;
            border-radius: 12px;
            color: #1e40af;
            font-size: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-family: 'Fredoka One', cursive;
        }

        .extra-point {
            width: 40px;
            height: 40px;
            filter: drop-shadow(0 0 5px #fbbf24);
        }

        .bomb {
            width: 45px;
            height: 45px;
            filter: drop-shadow(0 0 5px #ef4444);
        }

        #basket {
            position: absolute;
            bottom: 20px;
            width: 100px;
            height: 60px;
            transition: transform 0.1s ease-out;
            z-index: 50;
        }

        .ui-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            z-index: 100;
            pointer-events: none;
        }

        .definition-box {
            background: rgba(255, 255, 255, 0.9);
            border: 4px solid #3b82f6;
            border-radius: 20px;
            padding: 15px 25px;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            pointer-events: auto;
        }

        .word-progress {
            font-family: 'Fredoka One', cursive;
            letter-spacing: 4px;
            font-size: 28px;
            color: #1e40af;
            margin-top: 10px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            animation: explode 0.6s ease-out forwards;
        }

        @keyframes explode {
            to { transform: translate(var(--tx), var(--ty)); opacity: 0; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div class="ui-panel">
        <div class="definition-box" id="definition-container">
            <h2 class="text-blue-600 font-bold uppercase text-sm tracking-widest mb-1">Definition</h2>
            <p id="current-definition" class="text-xl md:text-2xl font-semibold text-gray-800">Loading...</p>
            <div id="countdown" class="text-red-500 font-bold mt-2 hidden text-lg">New word in: 3...</div>
            <div id="word-display" class="word-progress"></div>
        </div>
        
        <div class="flex justify-between mt-4 px-4 pointer-events-none">
            <div class="bg-white/90 px-4 py-2 rounded-full shadow-lg border-2 border-blue-400">
                <span class="text-gray-600 font-bold">SCORE: </span>
                <span id="score-val" class="text-blue-600 font-bold text-xl">0</span>
            </div>
        </div>
    </div>

    <!-- Basket SVG -->
    <div id="basket">
        <svg viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 10 L90 10 L80 50 L20 50 Z" fill="#92400e" stroke="#451a03" stroke-width="2"/>
            <path d="M5 5 L95 5 L95 15 L5 15 Z" fill="#b45309" rx="5"/>
            <path d="M20 15 L25 50 M40 15 L40 50 M60 15 L60 50 M80 15 L75 50" stroke="#451a03" stroke-width="1" opacity="0.4"/>
        </svg>
    </div>

    <!-- Start/End Screens -->
    <div id="overlay" class="modal">
        <div class="bg-white p-10 rounded-3xl shadow-2xl text-center max-w-md mx-4">
            <h1 id="modal-title" class="text-4xl font-bold text-blue-600 mb-4" style="font-family: 'Fredoka One'">Word Catcher</h1>
            <p id="modal-desc" class="text-gray-600 mb-8">Catch the letters to spell the word based on the definition. Avoid the bombs!</p>
            <button id="start-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-xl transition transform hover:scale-105 shadow-lg">
                PLAY GAME
            </button>
        </div>
    </div>
</div>

<script>
    const VOCABULARY = [
        { word: "CARRY LANTERNS", def: "What children do during Mid-Autumn Festival; often red in color or shaped like fish" },
        { word: "DECORATE THE CHRISTMAS TREE", def: "An activity done before Christmas so that you can place presents underneath it" },
        { word: "EXCHANGE GIFTS", def: "One of the most exciting parts of Christmas--hopefully, you get something good" },
        { word: "FESTIVAL", def: "A gathering of people to celebrate something" },
        { word: "LOCAL", def: "Being from a certain area" },
        { word: "TRADITIONAL", def: "Describing some practices and activities passed down from many generations" },
        { word: "CULTURAL", def: "Describing values and beliefs of a group of people" },
        { word: "SOCIAL", def: "Enjoying talking with other people" },
        { word: "CANDLE", def: "Something lit with fire to create light" },
        { word: "CELEBRATE", def: "Something we do to acknowledge something happy or exciting" }
    ];

    const gameContainer = document.getElementById('game-container');
    const basket = document.getElementById('basket');
    const scoreVal = document.getElementById('score-val');
    const defText = document.getElementById('current-definition');
    const wordDisplay = document.getElementById('word-display');
    const countdownText = document.getElementById('countdown');
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('start-btn');
    const modalTitle = document.getElementById('modal-title');
    const modalDesc = document.getElementById('modal-desc');

    let state = {
        score: 0,
        currentWordIndex: 0,
        typedIndex: 0, // tracks current target letter in word
        active: false,
        basketX: window.innerWidth / 2,
        objects: [],
        nextSpawn: 0,
        isTransitioning: false
    };

    const CONFIG = {
        gravity: 3,
        spawnRate: 1500, // ms
        bonusChance: 0.15,
        bombChance: 0.2
    };

    function init() {
        startBtn.addEventListener('click', startGame);
        
        // Mouse/Touch movement
        window.addEventListener('mousemove', (e) => {
            if (state.active) updateBasket(e.clientX);
        });
        
        window.addEventListener('touchmove', (e) => {
            if (state.active) {
                e.preventDefault();
                updateBasket(e.touches[0].clientX);
            }
        }, { passive: false });

        window.addEventListener('resize', () => {
            state.basketX = Math.min(state.basketX, window.innerWidth - 100);
        });
    }

    function updateBasket(x) {
        const basketWidth = basket.offsetWidth;
        let newX = x - basketWidth / 2;
        newX = Math.max(0, Math.min(newX, window.innerWidth - basketWidth));
        state.basketX = newX;
        basket.style.left = `${newX}px`;
    }

    function startGame() {
        state.score = 0;
        state.currentWordIndex = 0;
        state.active = true;
        state.objects.forEach(obj => obj.el.remove());
        state.objects = [];
        overlay.classList.add('hidden');
        scoreVal.innerText = state.score;
        loadWord();
        requestAnimationFrame(gameLoop);
    }

    function loadWord() {
        if (state.currentWordIndex >= VOCABULARY.length) {
            endGame(true);
            return;
        }

        state.isTransitioning = true;
        state.typedIndex = 0;
        const currentWord = VOCABULARY[state.currentWordIndex];
        
        defText.innerText = currentWord.def;
        wordDisplay.innerHTML = renderWordProgress();
        
        // Delay for reading
        countdownText.classList.remove('hidden');
        let count = 3;
        countdownText.innerText = `New word in: ${count}...`;
        
        const timer = setInterval(() => {
            count--;
            if (count <= 0) {
                clearInterval(timer);
                countdownText.classList.add('hidden');
                state.isTransitioning = false;
            } else {
                countdownText.innerText = `New word in: ${count}...`;
            }
        }, 1000);
    }

    function renderWordProgress() {
        const word = VOCABULARY[state.currentWordIndex].word;
        return word.split('').map((char, i) => {
            if (char === ' ') return '&nbsp;&nbsp;';
            if (i < state.typedIndex) return `<span class="text-blue-600">${char}</span>`;
            return `<span class="text-gray-300">_</span>`;
        }).join('');
    }

    function spawnObject() {
        if (state.isTransitioning || !state.active) return;

        const now = Date.now();
        if (now < state.nextSpawn) return;

        const rand = Math.random();
        let type = 'letter';
        let content = '';

        if (rand < CONFIG.bombChance) {
            type = 'bomb';
        } else if (rand < CONFIG.bombChance + CONFIG.bonusChance) {
            type = 'bonus';
        } else {
            // Spawn letters. Focus on the required letter, but mix in others
            const currentWord = VOCABULARY[state.currentWordIndex].word;
            const targetChar = getNextTargetChar(currentWord, state.typedIndex);
            
            if (Math.random() < 0.6) {
                content = targetChar;
            } else {
                const alpha = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
                content = alpha[Math.floor(Math.random() * alpha.length)];
            }
        }

        const el = document.createElement('div');
        el.className = `game-object ${type === 'letter' ? 'letter' : ''}`;
        
        if (type === 'letter') {
            el.innerText = content;
        } else if (type === 'bonus') {
            el.innerHTML = `<svg class="extra-point" viewBox="0 0 24 24"><path fill="#fbbf24" d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z"/></svg>`;
        } else {
            el.innerHTML = `<svg class="bomb" viewBox="0 0 24 24"><path fill="#ef4444" d="M20,11H22V13H20V11M1,13H3V11H1V13M13,1H11V3H13V1M4.92,3.5L6.34,4.92L4.92,6.34L3.5,4.92L4.92,3.5M19.08,3.5L20.5,4.92L19.08,6.34L17.66,4.92L19.08,3.5M13,12H11V16H13V12M17,13H15V19H17V13M9,13H7V19H9V13M13,22H11V20H13V22M5,22H3V20H5V22M21,22H19V20H21V22M13,8H11V10H13V8Z"/></svg>`;
        }

        const x = Math.random() * (window.innerWidth - 60);
        el.style.left = `${x}px`;
        el.style.top = `-60px`;
        gameContainer.appendChild(el);

        state.objects.push({
            el,
            x,
            y: -60,
            type,
            value: content,
            speed: 2 + Math.random() * 2
        });

        state.nextSpawn = now + (CONFIG.spawnRate / (1 + state.score * 0.005));
    }

    function getNextTargetChar(word, currentIndex) {
        // Skip spaces
        while (currentIndex < word.length && word[currentIndex] === ' ') {
            currentIndex++;
        }
        return word[currentIndex] || '';
    }

    function gameLoop() {
        if (!state.active) return;

        spawnObject();

        const basketRect = basket.getBoundingClientRect();

        for (let i = state.objects.length - 1; i >= 0; i--) {
            const obj = state.objects[i];
            obj.y += obj.speed;
            obj.el.style.top = `${obj.y}px`;

            // Collision Detection
            const objRect = obj.el.getBoundingClientRect();
            
            const hit = !(objRect.right < basketRect.left || 
                          objRect.left > basketRect.right || 
                          objRect.bottom < basketRect.top || 
                          objRect.top > basketRect.bottom);

            if (hit) {
                handleCatch(obj);
                state.objects.splice(i, 1);
            } else if (obj.y > window.innerHeight) {
                obj.el.remove();
                state.objects.splice(i, 1);
            }
        }

        requestAnimationFrame(gameLoop);
    }

    function handleCatch(obj) {
        if (obj.type === 'bonus') {
            createParticles(obj.x + 20, obj.y + 20, '#fbbf24');
            updateScore(50);
        } else if (obj.type === 'bomb') {
            createParticles(obj.x + 20, obj.y + 20, '#ef4444');
            basket.classList.add('shake');
            setTimeout(() => basket.classList.remove('shake'), 500);
            updateScore(-20);
        } else {
            const currentWord = VOCABULARY[state.currentWordIndex].word;
            const target = getNextTargetChar(currentWord, state.typedIndex);

            if (obj.value === target) {
                // Correct letter
                createParticles(obj.x + 20, obj.y + 20, '#3b82f6');
                updateScore(10);
                
                // Move index (handle spaces)
                state.typedIndex++;
                while (state.typedIndex < currentWord.length && currentWord[state.typedIndex] === ' ') {
                    state.typedIndex++;
                }

                wordDisplay.innerHTML = renderWordProgress();

                // Check word completion
                if (state.typedIndex >= currentWord.length) {
                    state.currentWordIndex++;
                    setTimeout(loadWord, 500);
                }
            } else {
                // Wrong letter - reset score logic
                createParticles(obj.x + 20, obj.y + 20, '#991b1b');
                endGame(false);
            }
        }
        obj.el.remove();
    }

    function updateScore(amt) {
        state.score = Math.max(0, state.score + amt);
        scoreVal.innerText = state.score;
    }

    function createParticles(x, y, color) {
        for (let i = 0; i < 8; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = `${x}px`;
            p.style.top = `${y}px`;
            p.style.width = '8px';
            p.style.height = '8px';
            p.style.backgroundColor = color;
            const tx = (Math.random() - 0.5) * 100;
            const ty = (Math.random() - 0.5) * 100;
            p.style.setProperty('--tx', `${tx}px`);
            p.style.setProperty('--ty', `${ty}px`);
            gameContainer.appendChild(p);
            setTimeout(() => p.remove(), 600);
        }
    }

    function endGame(victory) {
        state.active = false;
        overlay.classList.remove('hidden');
        
        if (victory) {
            modalTitle.innerText = "Word Master!";
            modalDesc.innerText = `Amazing! You finished all words.\nFinal Score: ${state.score}`;
        } else {
            modalTitle.innerText = "Game Over!";
            modalDesc.innerText = `Oops! You caught the wrong letter.\nFinal Score: ${state.score}`;
        }
        
        startBtn.innerText = "TRY AGAIN";
    }

    init();
</script>

</body>
</html>
